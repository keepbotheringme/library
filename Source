
-- UiLib - A comprehensive Roblox UI Library
local UiLib = {}

-- Configuration
UiLib.Config = {
	Theme = {
		Background = Color3.fromRGB(30, 30, 35),
		Foreground = Color3.fromRGB(45, 45, 50),
		Accent = Color3.fromRGB(0, 162, 255),
		Text = Color3.fromRGB(255, 255, 255),
		SubText = Color3.fromRGB(200, 200, 200),
		Border = Color3.fromRGB(60, 60, 65)
	},
	Font = Enum.Font.Gotham,
	TextSize = 14,
	CornerRadius = 0, -- No UICorner as requested
	AnimationSpeed = 0.2
}

-- Utility functions
local function Create(class, props)
	local obj = Instance.new(class)
	for prop, value in pairs(props) do
		if prop ~= "Children" and prop ~= "Parent" then
			obj[prop] = value
		end
	end
	if props.Children then
		for _, child in ipairs(props.Children) do
			child.Parent = obj
		end
	end
	if props.Parent then
		obj.Parent = props.Parent
	end
	return obj
end

local TweenService = game:GetService("TweenService")

-- Draggable Interface System
function UiLib.MakeDraggable(frame, handle)
	handle = handle or frame
	local dragging = false
	local dragInput, dragStart, startPos

	local function Update(input)
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end

	handle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	handle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)

	game:GetService("UserInputService").InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			Update(input)
		end
	end)
end

-- Search System
function UiLib.CreateSearchSystem(parent, callback)
	local searchFrame = Create("Frame", {
		Name = "SearchSystem",
		Parent = parent,
		BackgroundColor3 = UiLib.Config.Theme.Foreground,
		BorderColor3 = UiLib.Config.Theme.Border,
		Size = UDim2.new(1, 0, 0, 35),
		Children = {
			Create("TextBox", {
				Name = "SearchBox",
				BackgroundColor3 = UiLib.Config.Theme.Background,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(1, -10, 0, 30),
				Position = UDim2.new(0, 5, 0, 5),
				Font = UiLib.Config.Font,
				TextSize = UiLib.Config.TextSize,
				TextColor3 = UiLib.Config.Theme.Text,
				PlaceholderColor3 = UiLib.Config.Theme.SubText,
				PlaceholderText = "Search...",
				ClearTextOnFocus = false
			}),
			Create("ImageLabel", {
				Name = "SearchIcon",
				BackgroundTransparency = 1,
				Size = UDim2.new(0, 20, 0, 20),
				Position = UDim2.new(1, -30, 0, 7),
				Image = "rbxassetid://3926305904",
				ImageRectOffset = Vector2.new(964, 324),
				ImageRectSize = Vector2.new(36, 36),
				ImageColor3 = UiLib.Config.Theme.SubText
			})
		}
	})

	local searchBox = searchFrame.SearchBox
	local debounce = false

	searchBox:GetPropertyChangedSignal("Text"):Connect(function()
		if not debounce then
			debounce = true
			task.spawn(function()
				task.wait(0.3) -- Debounce
				if callback then
					callback(searchBox.Text)
				end
				debounce = false
			end)
		end
	end)

	return {
		Clear = function()
			searchBox.Text = ""
		end,
		SetText = function(text)
			searchBox.Text = text
		end,
		GetText = function()
			return searchBox.Text
		end
	}
end

-- Tab System
function UiLib.CreateTabSystem(parent)
	local tabSystem = Create("Frame", {
		Name = "TabSystem",
		Parent = parent,
		BackgroundColor3 = UiLib.Config.Theme.Background,
		BorderColor3 = UiLib.Config.Theme.Border,
		Size = UDim2.new(1, 0, 1, 0),
		Children = {
			Create("Frame", {
				Name = "TabButtons",
				BackgroundColor3 = UiLib.Config.Theme.Foreground,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(1, 0, 0, 40),
				Children = {
					Create("UIListLayout", {
						FillDirection = Enum.FillDirection.Horizontal,
						SortOrder = Enum.SortOrder.LayoutOrder
					})
				}
			}),
			Create("Frame", {
				Name = "TabContent",
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 0, 0, 40),
				Size = UDim2.new(1, 0, 1, -40)
			})
		}
	})

	local tabButtons = tabSystem.TabButtons
	local tabContent = tabSystem.TabContent
	local tabs = {}
	local currentTab

	function tabs:AddTab(title)
		local tabButton = Create("TextButton", {
			Name = title .. "Tab",
			BackgroundColor3 = UiLib.Config.Theme.Foreground,
			BorderColor3 = UiLib.Config.Theme.Border,
			Size = UDim2.new(0, 100, 1, 0),
			Font = UiLib.Config.Font,
			Text = title,
			TextColor3 = UiLib.Config.Theme.SubText,
			TextSize = UiLib.Config.TextSize,
			LayoutOrder = #tabs
		})

		local tabFrame = Create("ScrollingFrame", {
			Name = title .. "Content",
			BackgroundTransparency = 1,
			Size = UDim2.new(1, 0, 1, 0),
			ScrollBarThickness = 3,
			ScrollBarImageColor3 = UiLib.Config.Theme.Border,
			CanvasSize = UDim2.new(0, 0, 0, 0),
			Visible = false,
			Children = {
				Create("UIListLayout", {
					SortOrder = Enum.SortOrder.LayoutOrder,
					Padding = UDim.new(0, 5)
				}),
				Create("UIPadding", {
					PaddingTop = UDim.new(0, 5),
					PaddingLeft = UDim.new(0, 5),
					PaddingRight = UDim.new(0, 5)
				})
			}
		})

		tabButton.Parent = tabButtons
		tabFrame.Parent = tabContent

		tabButton.MouseButton1Click:Connect(function()
			if currentTab then
				currentTab.Button.TextColor3 = UiLib.Config.Theme.SubText
				currentTab.Frame.Visible = false
			end
			
			currentTab = {Button = tabButton, Frame = tabFrame}
			tabButton.TextColor3 = UiLib.Config.Theme.Accent
			tabFrame.Visible = true
		end)

		-- Select first tab
		if not currentTab then
			tabButton.TextColor3 = UiLib.Config.Theme.Accent
			tabFrame.Visible = true
			currentTab = {Button = tabButton, Frame = tabFrame}
		end

		return tabFrame
	end

	return tabs
end

-- Section System
function UiLib.CreateSection(parent, title)
	local section = Create("Frame", {
		Name = title .. "Section",
		Parent = parent,
		BackgroundColor3 = UiLib.Config.Theme.Foreground,
		BorderColor3 = UiLib.Config.Theme.Border,
		Size = UDim2.new(1, 0, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
		Children = {
			Create("TextLabel", {
				Name = "Title",
				BackgroundTransparency = 1,
				Size = UDim2.new(1, -10, 0, 25),
				Position = UDim2.new(0, 5, 0, 0),
				Font = UiLib.Config.Font,
				Text = title,
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize,
				TextXAlignment = Enum.TextXAlignment.Left
			}),
			Create("Frame", {
				Name = "Content",
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 0, 0, 25),
				Size = UDim2.new(1, 0, 0, 0),
				AutomaticSize = Enum.AutomaticSize.Y,
				Children = {
					Create("UIListLayout", {
						SortOrder = Enum.SortOrder.LayoutOrder,
						Padding = UDim.new(0, 5)
					}),
					Create("UIPadding", {
						PaddingTop = UDim.new(0, 5),
						PaddingBottom = UDim.new(0, 5),
						PaddingLeft = UDim.new(0, 5),
						PaddingRight = UDim.new(0, 5)
					})
				}
			})
		}
	})

	return section.Content
end

-- Paragraph Element
function UiLib.CreateParagraph(parent, text, alignment)
	local alignment = alignment or "Left"
	local textXAlignment = Enum.TextXAlignment[alignment]

	local paragraph = Create("TextLabel", {
		Name = "Paragraph",
		Parent = parent,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
		Font = UiLib.Config.Font,
		Text = text,
		TextColor3 = UiLib.Config.Theme.Text,
		TextSize = UiLib.Config.TextSize,
		TextWrapped = true,
		TextXAlignment = textXAlignment,
		TextYAlignment = Enum.TextYAlignment.Top
	})

	return {
		SetValue = function(newText)
			paragraph.Text = newText
		end,
		SetAlignment = function(newAlignment)
			paragraph.TextXAlignment = Enum.TextXAlignment[newAlignment]
		end
	}
end

-- Button Element
function UiLib.CreateButton(parent, title, callback)
	local button = Create("TextButton", {
		Name = title .. "Button",
		Parent = parent,
		BackgroundColor3 = UiLib.Config.Theme.Background,
		BorderColor3 = UiLib.Config.Theme.Border,
		Size = UDim2.new(1, 0, 0, 30),
		Font = UiLib.Config.Font,
		Text = title,
		TextColor3 = UiLib.Config.Theme.Text,
		TextSize = UiLib.Config.TextSize,
		AutoButtonColor = false
	})

	local originalColor = button.BackgroundColor3

	button.MouseEnter:Connect(function()
		TweenService:Create(button, TweenInfo.new(0.1), {
			BackgroundColor3 = originalColor:Lerp(UiLib.Config.Theme.Accent, 0.3)
		}):Play()
	end)

	button.MouseLeave:Connect(function()
		TweenService:Create(button, TweenInfo.new(0.1), {
			BackgroundColor3 = originalColor
		}):Play()
	end)

	button.MouseButton1Click:Connect(function()
		if callback then
			callback()
		end
	end)

	return {
		SetCallback = function(newCallback)
			callback = newCallback
		end,
		SetText = function(newText)
			button.Text = newText
		end,
		SetVisible = function(visible)
			button.Visible = visible
		end
	}
end

-- Toggle Element
function UiLib.CreateToggle(parent, title, default, callback)
	local toggleState = default or false

	local toggle = Create("Frame", {
		Name = title .. "Toggle",
		Parent = parent,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 30),
		Children = {
			Create("TextLabel", {
				Name = "Title",
				BackgroundTransparency = 1,
				Size = UDim2.new(1, -40, 1, 0),
				Font = UiLib.Config.Font,
				Text = title,
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize,
				TextXAlignment = Enum.TextXAlignment.Left
			}),
			Create("Frame", {
				Name = "ToggleFrame",
				BackgroundColor3 = UiLib.Config.Theme.Background,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 30, 0, 15),
				Position = UDim2.new(1, -35, 0.5, -7.5)
			}),
			Create("Frame", {
				Name = "ToggleButton",
				BackgroundColor3 = UiLib.Config.Theme.SubText,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 11, 0, 11),
				Position = UDim2.new(0, 2, 0, 2)
			})
		}
	})

	local toggleFrame = toggle.ToggleFrame
	local toggleButton = toggle.ToggleButton

	local function UpdateToggle()
		if toggleState then
			TweenService:Create(toggleButton, TweenInfo.new(0.2), {
				Position = UDim2.new(0, 17, 0, 2),
				BackgroundColor3 = UiLib.Config.Theme.Accent
			}):Play()
			TweenService:Create(toggleFrame, TweenInfo.new(0.2), {
				BackgroundColor3 = UiLib.Config.Theme.Accent:lerp(Color3.new(1,1,1), 0.7)
			}):Play()
		else
			TweenService:Create(toggleButton, TweenInfo.new(0.2), {
				Position = UDim2.new(0, 2, 0, 2),
				BackgroundColor3 = UiLib.Config.Theme.SubText
			}):Play()
			TweenService:Create(toggleFrame, TweenInfo.new(0.2), {
				BackgroundColor3 = UiLib.Config.Theme.Background
			}):Play()
		end
	end

	toggleFrame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			toggleState = not toggleState
			UpdateToggle()
			if callback then
				callback(toggleState)
			end
		end
	end)

	UpdateToggle()

	return {
		SetValue = function(value)
			toggleState = value
			UpdateToggle()
		end,
		GetValue = function()
			return toggleState
		end,
		SetCallback = function(newCallback)
			callback = newCallback
		end
	}
end

-- Slider Element
function UiLib.CreateSlider(parent, title, min, max, default, callback)
	local value = default or min
	local sliding = false

	local slider = Create("Frame", {
		Name = title .. "Slider",
		Parent = parent,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 50),
		Children = {
			Create("TextLabel", {
				Name = "Title",
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, 20),
				Font = UiLib.Config.Font,
				Text = title,
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize,
				TextXAlignment = Enum.TextXAlignment.Left
			}),
			Create("TextLabel", {
				Name = "Value",
				BackgroundTransparency = 1,
				Size = UDim2.new(0, 50, 0, 20),
				Position = UDim2.new(1, -50, 0, 0),
				Font = UiLib.Config.Font,
				Text = tostring(value),
				TextColor3 = UiLib.Config.Theme.SubText,
				TextSize = UiLib.Config.TextSize,
				TextXAlignment = Enum.TextXAlignment.Right
			}),
			Create("Frame", {
				Name = "SliderTrack",
				BackgroundColor3 = UiLib.Config.Theme.Background,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(1, 0, 0, 10),
				Position = UDim2.new(0, 0, 1, -15)
			}),
			Create("Frame", {
				Name = "SliderFill",
				BackgroundColor3 = UiLib.Config.Theme.Accent,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 0, 1, 0)
			}),
			Create("Frame", {
				Name = "SliderButton",
				BackgroundColor3 = Color3.fromRGB(255, 255, 255),
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 15, 0, 15),
				Position = UDim2.new(0, 0, 0.5, -7.5),
				ZIndex = 2
			})
		}
	})

	local valueLabel = slider.Value
	local track = slider.SliderTrack
	local fill = slider.SliderFill
	local button = slider.SliderButton

	local function UpdateSlider(input)
		local relativeX = (input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X
		local newValue = math.floor(min + (max - min) * math.clamp(relativeX, 0, 1))
		
		if newValue ~= value then
			value = newValue
			valueLabel.Text = tostring(value)
			
			local fillSize = math.clamp(relativeX, 0, 1)
			fill.Size = UDim2.new(fillSize, 0, 1, 0)
			button.Position = UDim2.new(fillSize, -7.5, 0.5, -7.5)
			
			if callback then
				callback(value)
			end
		end
	end

	track.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			sliding = true
			UpdateSlider(input)
		end
	end)

	track.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			sliding = false
		end
	end)

	game:GetService("UserInputService").InputChanged:Connect(function(input)
		if sliding and input.UserInputType == Enum.UserInputType.MouseMovement then
			UpdateSlider(input)
		end
	end)

	-- Set initial value
	local initialFill = (value - min) / (max - min)
	fill.Size = UDim2.new(initialFill, 0, 1, 0)
	button.Position = UDim2.new(initialFill, -7.5, 0.5, -7.5)

	return {
		SetValue = function(newValue)
			value = math.clamp(newValue, min, max)
			valueLabel.Text = tostring(value)
			local fillSize = (value - min) / (max - min)
			fill.Size = UDim2.new(fillSize, 0, 1, 0)
			button.Position = UDim2.new(fillSize, -7.5, 0.5, -7.5)
		end,
		GetValue = function()
			return value
		end
	}
end

-- Dropdown Element
function UiLib.CreateDropdown(parent, title, values, default, multi, callback, searchable, numeric)
	local dropdownOpen = false
	local selected = multi and {} or (default or values[1])
	local isNumeric = numeric or false

	local dropdown = Create("Frame", {
		Name = title .. "Dropdown",
		Parent = parent,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 30),
		Children = {
			Create("TextLabel", {
				Name = "Title",
				BackgroundTransparency = 1,
				Size = UDim2.new(1, -100, 1, 0),
				Font = UiLib.Config.Font,
				Text = title,
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize,
				TextXAlignment = Enum.TextXAlignment.Left
			}),
			Create("TextButton", {
				Name = "DropdownButton",
				BackgroundColor3 = UiLib.Config.Theme.Background,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 95, 0, 25),
				Position = UDim2.new(1, -95, 0.5, -12.5),
				Font = UiLib.Config.Font,
				Text = multi and "Select..." or tostring(selected),
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize,
				AutoButtonColor = false
			}),
			Create("ScrollingFrame", {
				Name = "DropdownList",
				BackgroundColor3 = UiLib.Config.Theme.Foreground,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(1, 0, 0, 0),
				Position = UDim2.new(0, 0, 1, 5),
				ScrollBarThickness = 3,
				ScrollBarImageColor3 = UiLib.Config.Theme.Border,
				CanvasSize = UDim2.new(0, 0, 0, 0),
				Visible = false,
				ClipsDescendants = true,
				Children = {
					Create("UIListLayout", {
						SortOrder = Enum.SortOrder.LayoutOrder
					})
				}
			})
		}
	})

	local dropdownButton = dropdown.DropdownButton
	local dropdownList = dropdown.DropdownList

	local function UpdateButtonText()
		if multi then
			if #selected == 0 then
				dropdownButton.Text = "Select..."
			elseif #selected <= 2 then
				dropdownButton.Text = table.concat(selected, ", ")
			else
				dropdownButton.Text = #selected .. " selected"
			end
		else
			dropdownButton.Text = tostring(selected)
		end
	end

	local function CreateOption(value)
		local option = Create("TextButton", {
			Name = tostring(value),
			BackgroundColor3 = UiLib.Config.Theme.Background,
			BorderColor3 = UiLib.Config.Theme.Border,
			Size = UDim2.new(1, -10, 0, 25),
			Font = UiLib.Config.Font,
			Text = tostring(value),
			TextColor3 = UiLib.Config.Theme.Text,
			TextSize = UiLib.Config.TextSize,
			AutoButtonColor = false
		})

		local function UpdateOption()
			if multi then
				local isSelected = table.find(selected, value) ~= nil
				option.BackgroundColor3 = isSelected and UiLib.Config.Theme.Accent or UiLib.Config.Theme.Background
			else
				option.BackgroundColor3 = (selected == value) and UiLib.Config.Theme.Accent or UiLib.Config.Theme.Background
			end
		end

		option.MouseButton1Click:Connect(function()
			if multi then
				local index = table.find(selected, value)
				if index then
					table.remove(selected, index)
				else
					table.insert(selected, value)
				end
			else
				selected = value
				dropdownOpen = false
				dropdownList.Visible = false
				dropdownList.Size = UDim2.new(1, 0, 0, 0)
			end

			UpdateButtonText()
			UpdateOption()

			if callback then
				if multi then
					callback(selected)
				else
					callback(value)
				end
			end
		end)

		UpdateOption()
		return option
	end

	local function RefreshOptions(filter)
		dropdownList:ClearAllChildren()
		
		local uiListLayout = Create("UIListLayout", {
			SortOrder = Enum.SortOrder.LayoutOrder
		})
		uiListLayout.Parent = dropdownList

		local count = 0
		local height = 0

		for _, value in ipairs(values) do
			local valueStr = tostring(value)
			if not filter or string.find(string.lower(valueStr), string.lower(filter)) then
				local option = CreateOption(value)
				option.Parent = dropdownList
				option.LayoutOrder = count
				count += 1
				height += 25
			end
		end

		dropdownList.CanvasSize = UDim2.new(0, 0, 0, height)
		dropdownList.Size = UDim2.new(1, 0, 0, math.min(150, height))
	end

	dropdownButton.MouseButton1Click:Connect(function()
		dropdownOpen = not dropdownOpen
		if dropdownOpen then
			RefreshOptions()
		end
		dropdownList.Visible = dropdownOpen
	end)

	UpdateButtonText()

	return {
		SetValue = function(newValue)
			if multi then
				selected = type(newValue) == "table" and newValue or {newValue}
			else
				selected = newValue
			end
			UpdateButtonText()
			RefreshOptions()
		end,
		GetValue = function()
			return selected
		end,
		Refresh = function(newValues)
			values = newValues
			RefreshOptions()
		end
	}
end

-- Color Picker Element
function UiLib.CreateColorPicker(parent, title, default, callback)
	local currentColor = default or Color3.fromRGB(255, 255, 255)
	local pickerOpen = false

	local colorPicker = Create("Frame", {
		Name = title .. "ColorPicker",
		Parent = parent,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 30),
		Children = {
			Create("TextLabel", {
				Name = "Title",
				BackgroundTransparency = 1,
				Size = UDim2.new(1, -60, 1, 0),
				Font = UiLib.Config.Font,
				Text = title,
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize,
				TextXAlignment = Enum.TextXAlignment.Left
			}),
			Create("TextButton", {
				Name = "ColorButton",
				BackgroundColor3 = currentColor,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 50, 0, 25),
				Position = UDim2.new(1, -55, 0.5, -12.5),
				Font = UiLib.Config.Font,
				Text = "",
				AutoButtonColor = false
			}),
			Create("Frame", {
				Name = "ColorWheel",
				BackgroundColor3 = UiLib.Config.Theme.Foreground,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 200, 0, 200),
				Position = UDim2.new(1, 5, 0, 0),
				Visible = false,
				ZIndex = 10,
				Children = {
					Create("ImageLabel", {
						Name = "Wheel",
						BackgroundTransparency = 1,
						Size = UDim2.new(1, -40, 1, -40),
						Position = UDim2.new(0, 20, 0, 20),
						Image = "rbxassetid://13782686220", -- Color wheel image
						ImageColor3 = Color3.fromRGB(255, 255, 255)
					}),
					Create("Frame", {
						Name = "Selector",
						BackgroundColor3 = Color3.fromRGB(255, 255, 255),
						BorderColor3 = Color3.fromRGB(0, 0, 0),
						Size = UDim2.new(0, 10, 0, 10),
						Position = UDim2.new(0.5, -5, 0.5, -5),
						ZIndex = 11
					}),
					Create("TextLabel", {
						Name = "RGBLabel",
						BackgroundTransparency = 1,
						Size = UDim2.new(1, 0, 0, 20),
						Position = UDim2.new(0, 0, 1, -25),
						Font = UiLib.Config.Font,
						Text = string.format("RGB: %d, %d, %d", 
							math.floor(currentColor.R * 255),
							math.floor(currentColor.G * 255), 
							math.floor(currentColor.B * 255)),
						TextColor3 = UiLib.Config.Theme.Text,
						TextSize = UiLib.Config.TextSize
					})
				}
			})
		}
	})

	local colorButton = colorPicker.ColorButton
	local colorWheel = colorPicker.ColorWheel
	local wheel = colorWheel.Wheel
	local selector = colorWheel.Selector
	local rgbLabel = colorWheel.RGBLabel

	local function UpdateColor(color, fromWheel)
		currentColor = color
		colorButton.BackgroundColor3 = color
		rgbLabel.Text = string.format("RGB: %d, %d, %d", 
			math.floor(color.R * 255),
			math.floor(color.G * 255), 
			math.floor(color.B * 255))

		if callback then
			callback(color)
		end
	end

	colorButton.MouseButton1Click:Connect(function()
		pickerOpen = not pickerOpen
		colorWheel.Visible = pickerOpen
	end)

	-- Simple color selection (for demonstration)
	-- In a real implementation, you'd want proper color wheel functionality
	wheel.MouseButton1Down:Connect(function()
		local connection
		connection = game:GetService("UserInputService").InputChanged:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseMovement then
				local mousePos = input.Position
				local wheelPos = wheel.AbsolutePosition
				local wheelSize = wheel.AbsoluteSize
				
				local relativeX = (mousePos.X - wheelPos.X) / wheelSize.X
				local relativeY = (mousePos.Y - wheelPos.Y) / wheelSize.Y
				
				relativeX = math.clamp(relativeX, 0, 1)
				relativeY = math.clamp(relativeY, 0, 1)
				
				selector.Position = UDim2.new(relativeX, -5, relativeY, -5)
				
				-- Simple HSV to RGB conversion
				local hue = relativeX
				local saturation = 1 - relativeY
				local value = 1
				
				local color = Color3.fromHSV(hue, saturation, value)
				UpdateColor(color, true)
			end
		end)
		
		game:GetService("UserInputService").InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				connection:Disconnect()
			end
		end)
	end)

	return {
		SetColor = function(color)
			UpdateColor(color)
		end,
		GetColor = function()
			return currentColor
		end
	}
end

-- Create Main Window
function UiLib.CreateWindow(title, size, position)
	local gui = Create("ScreenGui", {
		Name = "UiLib",
		ResetOnSpawn = false
	})

	local mainWindow = Create("Frame", {
		Name = "MainWindow",
		Parent = gui,
		BackgroundColor3 = UiLib.Config.Theme.Background,
		BorderColor3 = UiLib.Config.Theme.Border,
		Size = size or UDim2.new(0, 500, 0, 400),
		Position = position or UDim2.new(0.5, -250, 0.5, -200),
		Children = {
			Create("TextLabel", {
				Name = "Title",
				BackgroundColor3 = UiLib.Config.Theme.Foreground,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(1, 0, 0, 30),
				Font = UiLib.Config.Font,
				Text = title,
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize
			}),
			Create("TextButton", {
				Name = "CloseButton",
				BackgroundColor3 = UiLib.Config.Theme.Foreground,
				BorderColor3 = UiLib.Config.Theme.Border,
				Size = UDim2.new(0, 30, 0, 30),
				Position = UDim2.new(1, -30, 0, 0),
				Font = UiLib.Config.Font,
				Text = "X",
				TextColor3 = UiLib.Config.Theme.Text,
				TextSize = UiLib.Config.TextSize,
				AutoButtonColor = false
			})
		}
	})

	-- Make window draggable
	UiLib.MakeDraggable(mainWindow, mainWindow.Title)

	-- Close button functionality
	mainWindow.CloseButton.MouseButton1Click:Connect(function()
		gui:Destroy()
	end)

	return {
		Gui = gui,
		Window = mainWindow,
		Close = function()
			gui:Destroy()
		end,
		SetVisible = function(visible)
			gui.Enabled = visible
		end
	}
end

return UiLib
